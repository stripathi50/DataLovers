---
title: "Project"
author: "Data lovers"
date: "10 oct 2021"
# date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
---

```{r init, include=FALSE}
# some of common options (and the defaults) are: 
# include=T, eval=T, echo=T, results='hide'/'asis'/'markup',..., collapse=F, warning=T, message=T, error=T, cache=T, fig.width=6, fig.height=4, fig.dim=c(6,4) #inches, fig.align='left'/'center','right', 
library(ezids)
# knitr::opts_chunk$set(warning = F, results = "markup", message = F)
knitr::opts_chunk$set(warning = F, results = "hide", message = F)
options(scientific=T, digits = 3) 
# options(scipen=9, digits = 3) 
# ‘scipen’: integer. A penalty to be applied when deciding to print numeric values in fixed or exponential notation.  Positive values bias towards fixed and negative towards scientific notation: fixed notation will be preferred unless it is more than ‘scipen’ digits wider.
# use scipen=999 to prevent scientific notation at all times
```



**importing the dataset as Adata, and making sure the data type for the variables are set properly for categorical variables.**

```{r step1}
Adata1 <- data.frame(read.csv("acs2015_county_data.csv",header = TRUE))

str(Adata1)

#summary(Adata1)

#  we don't need to change any variables type, all of them set properly.
# There are a lot of variables , we may drop some of them, like :
#Hispanic, White,	Black,	Native,	Asian	Pacific, IncomeErr,	IncomePerCap,	IncomePerCapErr


# Dropping columns as agreed.  

Adata <- data.frame (subset(Adata1, select = -c(Hispanic,White,Black, Native, Asian, Pacific,IncomeErr, IncomePerCap, IncomePerCapErr, Drive, Carpool, Transit, Walk, OtherTransp, MeanCommute)))

str(Adata)
summary(Adata)
  

```



***Cleaning the data. removing the outliers and the NA from the income. Saving the resulting dataframe as Adata2. **

```{r step2}

# After reading the data we need now to clean it to prepare for the analysis. 
# We started with "income", first we polte it to identify the outlier and then removing it. 
# Also , we removed the null values because it make error while do mathematics calculation. 
# Then we follow the same steps for the remaining columns that we will gonna use in this phase. 

################################################################################


# First, lets take a look at the histogram for the income to detect the outliers 



hist(Adata$Income,
  xlab = "Income",
  main = "Histogram of Income",
  breaks = sqrt(nrow(Adata))
) # set number of bins




# # Now, we can extract the outliers from the incom using boxplot.stats()$out function.  
 income_out <- boxplot.stats(Adata$Income)$out
 income_out


# To count how many outliers in the income
 x <- data.frame(income_out)
x 
 nrow(x) # outliers numbers for income


 #Now, we will remove the outliers from our dataset and store the clean result in Adata2

  Adata2<- Adata[-which(Adata$Income %in% income_out),] # here we removed income outlier


 Adata2
 
 hist(Adata2$Income,
  xlab = "Income",
  main = "Histogram of Income",
  breaks = sqrt(nrow(Adata2))
) # set number of bins

 
# #Adata
# Adata2 


 # Now we will remove the naull values from the incmoe to allow for math calculations. 
 
 my.null <- data.frame (subset(Adata2,subset= is.na(Adata2$Income)))# To indicate the null values of income. 
my.null


Adata3 <- data.frame (subset(Adata2, subset= CensusId!= 48301 )) # To remove the record that contains null value

# Now we can calculate the max, mean , min .. etc of the income
max(Adata3$Income)
mean(Adata3$Income)
min(Adata3$Income)



```




**Cleaning the data for population column. **

```{r}

# same thing for population column. clean the data. 

# First, lets take a look at the histogram for the population to detect the outliers 



hist(Adata3$TotalPop,
  xlab = "TotalPop",
  main = "Histogram of Population",
  breaks = sqrt(nrow(Adata3))
) # set number of bins




# # Now, we can extract the outliers from the population using boxplot.stats()$out function.  
 pop_out <- boxplot.stats(Adata3$TotalPop)$out
 pop_out


# To count how many outliers in the population
 x2 <- data.frame(pop_out)
x2 
 nrow(x2) # outliers numbers 


 #Now, we will remove the outliers from our dataset and store the clean result in Adata4

  Adata4<- Adata3[-which(Adata3$TotalPop %in% pop_out),] # here we removed  outlier


 Adata4
 
 hist(Adata4$TotalPop,
  xlab = "TotalPop",
  main = "Histogram of Population",
  breaks = sqrt(nrow(Adata4))
) # set number of bins

 
# #Adata
# Adata2 


 # Now we will remove the naull values from the population to allow for math calculations. 
 
 my.null2 <- data.frame (subset(Adata4,subset= is.na(Adata4$TotalPop)))# To indicate the null values of Population 
my.null2  # No null values. 


# Now we can calculate the max and the mean .. etc of the population. 
max(Adata4$TotalPop)
mean(Adata4$TotalPop)
min(Adata4$TotalPop)



```



**Cleaning the data for Poverty column. **
```{r}


# same thing for poverty column. clean the data. 

# First, lets take a look at the histogram for the poverty to detect the outliers 



hist(Adata4$Poverty,
  xlab = "Poverty",
  main = "Histogram of Poverty",
  breaks = sqrt(nrow(Adata4))
) # set number of bins




# # Now, we can extract the outliers from the population using boxplot.stats()$out function.  
 Poverty_out <- boxplot.stats(Adata4$Poverty)$out
 Poverty_out


# To count how many outliers in the population
 x3 <- data.frame(Poverty_out)
x3 
 nrow(x3) # outliers numbers 


 #Now, we will remove the outliers from our dataset and store the clean result in Adata5

  Adata5<- Adata4[-which(Adata4$Poverty %in% Poverty_out),] # here we removed  outlier


 Adata5
 
 hist(Adata5$Poverty,
  xlab = "Poverty",
  main = "Histogram of Poverty",
  breaks = sqrt(nrow(Adata5))
) # set number of bins

 
 



 # No null values. 
 

# Now we can calculate the max and the mean .. etc of the population. 
max(Adata4$Poverty)
mean(Adata4$Poverty)
min (Adata4$Poverty)






```


**Cleaning the data for Child Poverty column. **

```{r}


# same thing for Child Poverty column. clean the data. 

# First, lets take a look at the histogram for the Child Poverty to detect the outliers 



hist(Adata5$ChildPoverty,
  xlab = "ChildPoverty",
  main = "Histogram of ChildPoverty",
  breaks = sqrt(nrow(Adata5))
) # set number of bins




# # Now, we can extract the outliers using boxplot.stats()$out function.  
 ChildPoverty_out <- boxplot.stats(Adata5$ChildPoverty)$out
 ChildPoverty_out


# To count how many outliers in the population
 x4 <- data.frame(ChildPoverty_out)
x4
 nrow(x4) # outliers numbers 


 #Now, we will remove the outliers from our dataset and store the clean result in Adata6

  Adata6<- Adata5[-which(Adata5$ChildPoverty %in% ChildPoverty_out),] # here we removed  outlier


 Adata6
 
 hist(Adata6$ChildPoverty,
  xlab = "ChildPoverty",
  main = "Histogram of Child Poverty",
  breaks = sqrt(nrow(Adata6))
) # set number of bins

 
 

 
 my.null3 <- data.frame (subset(Adata6,subset= is.na(Adata6$ChildPoverty)))# To indicate the null values
my.null3  
 

 Adata7 <- data.frame (subset(Adata6, subset= CensusId!= 15005 )) # To remove the record that contains null value



# Now we can calculate the max and the mean .. etc of the population. 
max(Adata7$ChildPoverty)
mean(Adata7$ChildPoverty)
min (Adata7$ChildPoverty)






```


**Cleaning the data for Employed column  ** 

```{r}

# same thing for Employed column. clean the data. 

# First, lets take a look at the histogram for the Employed to detect the outliers 



hist(Adata7$Employed,
  xlab = "Employed",
  main = "Histogram of Employed",
  breaks = sqrt(nrow(Adata7))
) # set number of bins




# # Now, we can extract the outliers using boxplot.stats()$out function.  
 Employed_out <- boxplot.stats(Adata7$Employed)$out
 Employed_out


# To count how many outliers in the population
 x5 <- data.frame(Employed_out)
x5
 nrow(x5) # outliers numbers 


 #Now, we will remove the outliers from our dataset and store the clean result in Adata8

  Adata8<- Adata7[-which(Adata7$Employed %in% Employed_out),] # here we removed outlier


 Adata8
 
 hist(Adata8$Employed,
  xlab = "Employed",
  main = "Histogram of Employed",
  breaks = sqrt(nrow(Adata8))
) # set number of bins

 
 
# No null values. 
 

# # Now we can calculate the max and the mean .. etc of the population. 
max(Adata8$Employed)
mean(Adata8$Employed)
min (Adata8$Employed)



```


**Cleaning the data for Unemployment column  ** 


```{r}


# same thing for Unemployment column. clean the data. 

# First, lets take a look at the histogram for the Unemployment to detect the outliers 



hist(Adata8$Unemployment,
  xlab = "Unemployment",
  main = "Histogram of Unemployment",
  breaks = sqrt(nrow(Adata8))
) # set number of bins




 # Now, we can extract the outliers using boxplot.stats()$out function.  
 Unemployment_out <- boxplot.stats(Adata8$Unemployment)$out
 Unemployment_out
# 
# 
#  To count how many outliers in the population
  x6 <- data.frame(Unemployment_out)
 x6
  nrow(x6) # outliers numbers 
# 
# 
 #Now, we will remove the outliers from our dataset and store the clean result in Adata9
# 
   Adata9<- Adata8[-which(Adata8$Unemploymen %in% Unemployment_out),] # here we removed outlier
# 
# 
 Adata9
#  
  hist(Adata9$Unemployment,
   xlab = "Unemployment",
   main = "Histogram of Unemployment",
   breaks = sqrt(nrow(Adata9))
) # set number of bins
  


# # No null values. 
 
# 
# # # Now we can calculate the max and the mean .. etc . 
 max(Adata9$Unemployment)
 mean(Adata9$Unemployment)
min (Adata9$Unemployment)
 



```





**The final data set.  ** 


```{r}


Adata9 

str(Adata9)

summary(Adata9)



```

```{r}

# Ignore this chunk. 

#I just was trying to use leaflet to create maps. 

# install.packages("httpuv")
# 
# library(leaflet)
# 
# 
# water_locations_map <- leaflet(Adata3$Income) %>%
#   addTiles() %>%
#   addCircleMarkers(lng = ~location.longitude,
#                    lat = ~location.latitude)


# m <- leaflet() %>%
#   addTiles() %>%  # Add default OpenStreetMap map tiles
#   addMarkers(lng=174.768, lat=-36.852, popup="Adata3$Income")
# m  # Print the map




# avg = mean(Adata3$Income[!Adata3$Income])
# #avg 



# Adata_test=Adata3 
# 
# #Adata_test
# 
# Adata_test[which(Adata$Income %in% income_out),"Income"]= 0 # to replace the outliers values with 0 
# 
# Adata_test
#  
#  #income_out
#  
#  #df$Variable1[df$outlier] = avg
# 
# 
# 
# #Adata_test[which(Adata$Income %in% income_out),] = 4

```


### Q

**. **


```{r}


 
```

### Question 7

**f **



**tests and results**

First, let's start to get a general idea of how poverty relates to all the factors by looking at the correlation matrix between 'Poverty' and the other variables.

```{r Q7, results='hold'}
subset1<-subset(Adata9,select = -c(CensusId,State,County))
cor(subset1)
```

If we look at the correlation matrix, we can see that the variables 'Income','ChildPoverty','Professional','Service','Production', 'WorkAtHome','PublicWork','SelfEmployed', and 'Unemployment' has relevantly high correlation. Therefore, we would like to compute some tests to see if they are truly the factors that affects poverty. 

We will now perform a two sample t-test to see if the counties with different income have different poverty. To setup, we divide the data into two parts (one with income values above the average income, the other with income values below average income) and take a sample of size 50. We set our hypothesis as:

$H_0$: $\mu_{upper}=\mu_{lower}$, the two sub-datasets have the same average poverty.
$H_1$: $\mu_{upper}\neq\mu_{lower}$, the two sub-datasets do not have the same average poverty.

```{r income test,results='hold'}
set.seed(123)
income_upper<-Adata9[Adata9$Income>mean(Adata9$Income),]
income_lower<-Adata9[Adata9$Income<mean(Adata9$Income),]
iu_sample<-income_upper[sample(nrow(income_upper),50),]
il_sample<-income_lower[sample(nrow(income_lower),50),]
income_ttest<-t.test(iu_sample$Poverty,il_sample$Poverty)
income_ttest
```

Since the p-value we got from the t-test is $2*10^{-13}$ which is smaller than a $\alpha$ value of 0.05, we have sufficient evidence to reject $H_0$ and conclude that there is a difference between the mean poverty for the two groups. Thus, 'poverty' is affected by 'Income'.

```{r professional test,results='hold'}
set.seed(123)
prof_upper<-Adata9[Adata9$Professional>mean(Adata9$Professional),]
prof_lower<-Adata9[Adata9$Professional<mean(Adata9$Professional),]
pu_sample<-prof_upper[sample(nrow(prof_upper),50),]
pl_sample<-prof_lower[sample(nrow(prof_lower),50),]
prof_ttest<-t.test(pu_sample$Poverty,pl_sample$Poverty)
prof_ttest
```

```{r service test,results='hold'}
set.seed(123)
serv_upper<-Adata9[Adata9$Service>mean(Adata9$Service),]
serv_lower<-Adata9[Adata9$Service<mean(Adata9$Service),]
su_sample<-serv_upper[sample(nrow(serv_upper),50),]
sl_sample<-serv_lower[sample(nrow(serv_lower),50),]
serv_ttest<-t.test(su_sample$Poverty,sl_sample$Poverty)
serv_ttest
```

```{r production test,results='hold'}
set.seed(123)
prod_upper<-Adata9[Adata9$Production>mean(Adata9$Production),]
prod_lower<-Adata9[Adata9$Production<mean(Adata9$Production),]
produ_sample<-prod_upper[sample(nrow(prod_upper),50),]
prodl_sample<-prod_lower[sample(nrow(prod_lower),50),]
prod_ttest<-t.test(produ_sample$Poverty,prodl_sample$Poverty)
prod_ttest
```

```{r production test,results='hold'}
set.seed(123)
WAH_upper<-Adata9[Adata9$WorkAtHome>mean(Adata9$WorkAtHome),]
WAH_lower<-Adata9[Adata9$WorkAtHome<mean(Adata9$WorkAtHome),]
wu_sample<-WAH_upper[sample(nrow(WAH_upper),50),]
wl_sample<-WAH_lower[sample(nrow(WAH_lower),50),]
WAH_ttest<-t.test(wu_sample$Poverty,wl_sample$Poverty)
WAH_ttest
```

```{r production test,results='hold'}
set.seed(123)
WAH_upper<-Adata9[Adata9$WorkAtHome>mean(Adata9$WorkAtHome),]
WAH_lower<-Adata9[Adata9$WorkAtHome<mean(Adata9$WorkAtHome),]
wu_sample<-WAH_upper[sample(nrow(WAH_upper),50),]
wl_sample<-WAH_lower[sample(nrow(WAH_lower),50),]
WAH_ttest<-t.test(wu_sample$Poverty,wl_sample$Poverty)
WAH_ttest
```
### Q

**.**

```{r Q8, results='hold'}



```





